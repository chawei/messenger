(function(e,i){"function"==typeof define&&define.amd?define(i):e.DS.Firebase=i()})(this,function(){var e,i,t;return function(n){function r(e,i){return _.call(e,i)}function o(e,i){var t,n,r,o,s,a,d,c,f,l,u=i&&i.split("/"),h=b.map,p=h&&h["*"]||{};if(e&&"."===e.charAt(0))if(i){for(u=u.slice(0,u.length-1),e=u.concat(e.split("/")),c=0;e.length>c;c+=1)if(l=e[c],"."===l)e.splice(c,1),c-=1;else if(".."===l){if(1===c&&(".."===e[2]||".."===e[0]))break;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((u||p)&&h){for(t=e.split("/"),c=t.length;c>0;c-=1){if(n=t.slice(0,c).join("/"),u)for(f=u.length;f>0;f-=1)if(r=h[u.slice(0,f).join("/")],r&&(r=r[n])){o=r,s=c;break}if(o)break;!a&&p&&p[n]&&(a=p[n],d=c)}!o&&a&&(o=a,s=d),o&&(t.splice(0,s,o),e=t.join("/"))}return e}function s(e,i){return function(){return h.apply(n,R.call(arguments,0).concat([e,i]))}}function a(e){return function(i){return o(i,e)}}function d(e){return function(i){v[e]=i}}function c(e){if(r(m,e)){var i=m[e];delete m[e],y[e]=!0,u.apply(n,i)}if(!r(v,e)&&!r(y,e))throw Error("No "+e);return v[e]}function f(e){var i,t=e?e.indexOf("!"):-1;return t>-1&&(i=e.substring(0,t),e=e.substring(t+1,e.length)),[i,e]}function l(e){return function(){return b&&b.config&&b.config[e]||{}}}var u,h,p,g,v={},m={},b={},y={},_=Object.prototype.hasOwnProperty,R=[].slice;p=function(e,i){var t,n=f(e),r=n[0];return e=n[1],r&&(r=o(r,i),t=c(r)),r?e=t&&t.normalize?t.normalize(e,a(i)):o(e,i):(e=o(e,i),n=f(e),r=n[0],e=n[1],r&&(t=c(r))),{f:r?r+"!"+e:e,n:e,pr:r,p:t}},g={require:function(e){return s(e)},exports:function(e){var i=v[e];return i!==void 0?i:v[e]={}},module:function(e){return{id:e,uri:"",exports:v[e],config:l(e)}}},u=function(e,i,t,o){var a,f,l,u,h,b,_=[];if(o=o||e,"function"==typeof t){for(i=!i.length&&t.length?["require","exports","module"]:i,h=0;i.length>h;h+=1)if(u=p(i[h],o),f=u.f,"require"===f)_[h]=g.require(e);else if("exports"===f)_[h]=g.exports(e),b=!0;else if("module"===f)a=_[h]=g.module(e);else if(r(v,f)||r(m,f)||r(y,f))_[h]=c(f);else{if(!u.p)throw Error(e+" missing "+f);u.p.load(u.n,s(o,!0),d(f),{}),_[h]=v[f]}l=t.apply(v[e],_),e&&(a&&a.exports!==n&&a.exports!==v[e]?v[e]=a.exports:l===n&&b||(v[e]=l))}else e&&(v[e]=t)},e=i=h=function(e,i,t,r,o){return"string"==typeof e?g[e]?g[e](i):c(p(e,i).f):(e.splice||(b=e,i.splice?(e=i,i=t,t=null):e=n),i=i||function(){},"function"==typeof t&&(t=r,r=o),r?u(n,e,i,t):setTimeout(function(){u(n,e,i,t)},4),h)},h.config=function(e){return b=e,b.deps&&h(b.deps,b.callback),h},t=function(e,i,t){i.splice||(t=i,i=[]),r(v,e)||r(m,e)||(m[e]=[e,i,t])},t.amd={jQuery:!0}}(),t("vendor/almond",function(){}),t("firebase_adapter",["firebase/adapter","firebase/model","firebase/serializer"],function(e,i,t){var n=e.Adapter,r=i.Model,o=i.LiveModel,s=t.Serializer,a={Adapter:n,Model:r,LiveModel:o,Serializer:s};return a}),t("firebase/adapter",["firebase/serializer","exports"],function(e,i){var t=e.Serializer,n=DS.Adapter.extend({serializer:t.create(),localLock:!1,_listenRefs:[],fb:void 0,init:function(){if(!this.dbName&&!this.url)throw Error("You must specify a dbName representing the subdomain of your Firebase.");this.url||(this.url="https://"+this.dbName+".firebaseio.com"),this.fb=new Firebase(this.url),this._super()},createRecords:function(e,i,t){t.forEach(function(e){var i=e.getRef(),t=e.serialize();this.localLock=!0,i.update(t),this.localLock=!1}.bind(this)),e.didSaveRecords(t)},updateRecords:function(e,i,t){t.forEach(function(e){var i=e.getRef(),t=e.serialize();i.update(t)}.bind(this)),e.didSaveRecords(t)},deleteRecords:function(e,i,t){t.forEach(function(e){var i=e.getRef();this.localLock=!0,i.remove(),this.localLock=!1}.bind(this)),e.didSaveRecords(t)},find:function(e,i,t){var n=this._getRefForType(i).child(t);n.once("value",function(n){var r=Ember.copy(n.val())||{};r.id=t,this.didFindRecord(e,i,r,t)}.bind(this))},findAll:function(e,i){var t=this._getRefForType(i);t.once("value",function(n){var r=[];n.forEach(function(e){var i=e.val();i.id=e.name(),r.push(Ember.copy(i))}.bind(this)),this.didFindAll(e,i,r),this._listenRefs.push(t),t.on("child_added",function(t){if(!this.localLock){var n=t.val();n.id=t.name(),this.didFindMany(e,i,[n])}}.bind(this)),t.on("child_removed",function(t){if(!this.localLock){var n=t.name(),r=e.findById(i,n);r&&r.deleteRecord()}}.bind(this))}.bind(this))},_getRefForType:function(e){var i=this.serializer.pluralize(this.serializer.rootForType(e));return this.fb.child(i)},destroy:function(){this._listenRefs.forEach(function(e){e.off("child_added"),e.off("child_removed")}),this._listenRefs.clear(),this._super()}});i.Adapter=n}),t("firebase/model",["exports"],function(e){var i=DS.Model.extend({getRef:function(){var e,i=this.store.adapter,t=i.serializer,n=t.pluralize(t.rootForType(this.constructor));Ember.get(this.constructor,"relationshipsByName").forEach(function(i,r){"belongsTo"==r.kind&&r.parentType==this.constructor&&t.embeddedType(r.type,n)&&(e=i)}.bind(this));var r;if(e){if(!this.get(e))return this.get("_ref");r=this.get(e).getRef()}else r=i.fb;var o;return this.get("id")?o=r.child(n).child(this.get("id")):(o=r.child(n).push(),this.set("id",o.name())),this.set("_ref",o),o}}),t=i.extend({init:function(){this._super(),this.on("didLoad",this._initLiveBindings.bind(this)),this.on("didCreate",this._initLiveBindings.bind(this))},_initLiveBindings:function(){if(!this.get("_liveBindingsWereEnabled")){this.set("_liveBindingsWereEnabled",!0);var e=this.getRef(),i=Ember.get(this.constructor,"attributes");e.on("child_added",function(e){i.get(e.name())&&void 0===this.get(e.name())&&(this.store.didUpdateAttribute(this,e.name(),e.val()),this.trigger("didUpdate"))}.bind(this)),e.on("child_changed",function(e){i.get(e.name())&&e.val()!==this.get(e.name())&&(this.store.didUpdateAttribute(this,e.name(),e.val()),this.trigger("didUpdate"))}.bind(this)),e.on("child_removed",function(e){this.bindingsDisabled||i.get(e.name())&&(void 0!==this.get(e.name())||this.get(null!==e.name()))&&(this.store.didUpdateAttribute(this,e.name(),null),this.trigger("didUpdate"))}.bind(this)),this.get("constructor.relationshipsByName").forEach(function(i,t){if("hasMany"==t.kind&&t.options.live===!0){console.log("adding live relation for "+t.key);var n=this.store.adapter.serializer.mappingOption(this.constructor,t.key,"embedded");"always"==n?(e.child(t.key).on("child_added",function(e){var i=e.name(),n=this.get(t.key).map(function(e){return e.get("id")});if(!n.contains(i)){var r=e.val(),i=e.name();r.id=i;var o;Ember.get(t.type,"relationshipsByName").forEach(function(e,i){"belongsTo"==i.kind&&i.type==t.parentType&&(o=e)}),o&&(r[o]=this);var s=t.type.createRecord(r);s.get("stateManager").send("willCommit"),s.get("stateManager").send("didCommit"),s._initLiveBindings()}}.bind(this)),e.child(t.key).on("child_removed",function(e){var i=e.name(),n=this.get(t.key).find(function(e){return e.get("id")==i});n&&(n.deleteRecord(),n.get("stateManager").send("willCommit"),n.get("stateManager").send("didCommit"))}.bind(this))):(e.child(t.key).on("child_added",function(e){var i=e.name(),n=this._data.hasMany[t.key],r=this.get("stateManager.currentState.name");if("inFlight"!==r&&void 0!==n&&!n.contains(i)){var o=t.type.find(i);this.get(t.key).pushObject(o)}}.bind(this)),e.child(t.key).on("child_removed",function(e){var i=e.name(),n=this.get(t.key).find(function(e){return e.get("id")==i});n&&(n.deleteRecord(),n.get("stateManager").send("willCommit"),n.get("stateManager").send("didCommit"))}.bind(this)))}}.bind(this))}},deleteRecord:function(){this.disableBindings(),this._super()},disableBindings:function(){var e=this.getRef();this.bindingsDisabled=!0,e.off("child_added"),e.off("child_changed"),e.off("child_removed")}});e.Model=i,e.LiveModel=t}),t("firebase/serializer",["exports"],function(e){var i=DS.JSONSerializer.extend({extract:function(e,i,t,n){this._super(e,this.rootJSON(i,t),t,n)},extractMany:function(e,i,t,n){this._super(e,this.rootJSON(i,t,"pluralize"),t,n)},rootJSON:function(e,i,t){var n=this.rootForType(i);"pluralize"==t&&(n=this.pluralize(n));var r={};return r[n]=e,r},rootForType:function(e){var i=this.mappings.get(e);return i&&i.resourceName?i.resourceName:this._super(e)},extractHasMany:function(e,i,t){var n=i[t],r=[];for(var t in n)r.push(t);return r},extractEmbeddedHasMany:function(e,i,t,n,r){var o,s=[];Ember.get(i.type,"relationshipsByName").forEach(function(e,t){"belongsTo"==t.kind&&t.type==i.parentType&&(o=e)});for(var a in t){var d=Ember.copy(t[a]);d.id=a,d[o]=n.id,s.push(d)}this._super(e,i,s,n,r)},addHasMany:function(e,i,t,n){var r,o,s=i.constructor,a=n.key;if(r=i.get(a),o=this.embeddedType(s,a),"always"!==o)return i.getRef().child(t).once("value",function(e){var n=[];e.forEach(function(e){n.push(e.name())}),r.forEach(function(e){e.getRef(i.get("id")),n.contains(e.get("id"))||i.getRef().child(t).child(e.get("id")).set(!0)})}),void 0;var d={};r.forEach(function(e){e.getRef(i.get("id")),d[e.get("id")]=e.serialize()},this),e[t]=d}});e.Serializer=i}),t("tmp/out",function(){}),i("firebase_adapter")});